{"version":3,"file":"auth.js","sources":["middlwares/auth.ts"],"sourceRoot":"/","sourcesContent":["// src/middlwares/auth.ts\r\nimport { Request, Response, NextFunction } from 'express';\r\nimport jwt from 'jsonwebtoken';\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'your_jwt_secret';\r\n\r\nexport interface JwtPayload {\r\n  id: number;\r\n  role: string;\r\n  firstName: string;\r\n  lastName: string;\r\n}\r\n\r\nexport const authorizeRole = (roles: string[]): ((req: Request & { user?: JwtPayload }, res: Response, next: NextFunction) => void) => {\r\n  return (req, res, next) => {\r\n    if (!req.user || !roles.includes(req.user.role)) {\r\n      res.status(403).json({ message: 'Access denied. Insufficient permissions.' });\r\n      return;\r\n    }\r\n    next();\r\n  };\r\n};\r\n\r\nexport const authenticateToken = (\r\n    req: Request & { user?: JwtPayload },\r\n    res: Response,\r\n    next: NextFunction\r\n  ): void => {\r\n\r\n    const authHeader = req.headers.authorization;\r\n    const token = authHeader?.split(' ')[1];\r\n  \r\n    if (!token) {\r\n      res.status(401).json({ message: 'Access denied. No token provided.' });\r\n      return;\r\n    }\r\n  \r\n    try {\r\n      const decoded = jwt.verify(token, JWT_SECRET) as JwtPayload;\r\n      req.user = decoded;\r\n      next(); // Викликаємо next() для передачі контролю наступному middleware\r\n    } catch (err) {\r\n      res.status(403).json({ message: 'Invalid token.' });\r\n      return;\r\n    }\r\n};\r\n  "],"names":[],"mappings":";;;;;;;;AAEA,gEAA+B;AAE/B,MAAM,UAAU,GAAG,OAAO,CAAC,GAAG,CAAC,UAAU,IAAI,iBAAiB,CAAC;AASxD,MAAM,aAAa,GAAG,CAAC,KAAe,EAAuF,EAAE;IACpI,OAAO,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,EAAE;QACxB,IAAI,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;YAChD,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,0CAA0C,EAAE,CAAC,CAAC;YAC9E,OAAO;QACT,CAAC;QACD,IAAI,EAAE,CAAC;IACT,CAAC,CAAC;AACJ,CAAC,CAAC;AARW,QAAA,aAAa,iBAQxB;AAEK,MAAM,iBAAiB,GAAG,CAC7B,GAAoC,EACpC,GAAa,EACb,IAAkB,EACZ,EAAE;IAER,MAAM,UAAU,GAAG,GAAG,CAAC,OAAO,CAAC,aAAa,CAAC;IAC7C,MAAM,KAAK,GAAG,UAAU,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IAExC,IAAI,CAAC,KAAK,EAAE,CAAC;QACX,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,mCAAmC,EAAE,CAAC,CAAC;QACvE,OAAO;IACT,CAAC;IAED,IAAI,CAAC;QACH,MAAM,OAAO,GAAG,sBAAG,CAAC,MAAM,CAAC,KAAK,EAAE,UAAU,CAAe,CAAC;QAC5D,GAAG,CAAC,IAAI,GAAG,OAAO,CAAC;QACnB,IAAI,EAAE,CAAC,CAAC,gEAAgE;IAC1E,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACb,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,gBAAgB,EAAE,CAAC,CAAC;QACpD,OAAO;IACT,CAAC;AACL,CAAC,CAAC;AAtBW,QAAA,iBAAiB,qBAsB5B","debug_id":"166e027e-d69e-512a-b698-68925a9f8a18"}