{"version":3,"file":"appointmentController.js","sources":["controllers/appointmentController.ts"],"sourceRoot":"/","sourcesContent":["import { Request, Response, NextFunction } from 'express';\r\nimport { AppointmentService } from '../services/appointmentService';\r\n\r\nexport class AppointmentController {\r\n  constructor(private appointmentService: AppointmentService) {}\r\n\r\n  createAppointment = async (req: Request & { user?: any }, res: Response, next: NextFunction): Promise<void> => {\r\n    if (!req.user) {\r\n      res.status(401).json({ message: 'Unauthorized: user not found' });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const { doctorId, serviceId, date } = req.body;\r\n      const newAppointment = await this.appointmentService.createAppointment(\r\n        req.user.id,\r\n        doctorId,\r\n        serviceId,\r\n        new Date(date)\r\n      );\r\n      res.status(201).json(newAppointment);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  updateAppointment = async (\r\n    req: Request & { user?: { id: number; role: string } },\r\n    res: Response,\r\n    next: NextFunction\r\n  ): Promise<void> => {\r\n    try {\r\n      const id = parseInt(req.params.id, 10);\r\n      const { date, status } = req.body;\r\n\r\n      const updated = await this.appointmentService.updateAppointment(id, req.user!, {\r\n        date: date ? new Date(date) : undefined,\r\n        status,\r\n      });\r\n\r\n      res.status(200).json({ message: 'Бронювання успішно оновлено.', updated });\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getAllAppointments = async (\r\n    req: Request & { user?: { id: number; role: string } },\r\n    res: Response,\r\n    next: NextFunction\r\n  ) => {\r\n    try {\r\n      const appointments = await this.appointmentService.getAllAppointments(req.user!);\r\n      res.status(200).json(appointments);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getAppointmentById = async (\r\n    req: Request & { user?: { id: number; role: string } },\r\n    res: Response,\r\n    next: NextFunction\r\n  ): Promise<void> => {\r\n    try {\r\n      const id = parseInt(req.params.id, 10);\r\n      const appointment = await this.appointmentService.getAppointmentById(id, req.user!);\r\n      res.json(appointment);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getBookedTimes = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const doctorId = parseInt(String(req.query.doctorId), 10);\r\n      const dateStr = String(req.query.date);\r\n      const serviceId = req.query.serviceId ? parseInt(String(req.query.serviceId), 10) : undefined;\r\n\r\n      if (isNaN(doctorId) || !dateStr) {\r\n        res.status(400).json({ message: 'Missing or invalid doctorId or date parameter' });\r\n        return;\r\n      }\r\n\r\n      const times = await this.appointmentService.getBookedTimes(doctorId, dateStr, serviceId);\r\n      res.json(times);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  deleteAppointment = async (\r\n    req: Request & { user?: { id: number; role: string } },\r\n    res: Response,\r\n    next: NextFunction\r\n  ): Promise<void> => {\r\n    try {\r\n      const id = parseInt(req.params.id, 10);\r\n      await this.appointmentService.deleteAppointment(id, req.user!);\r\n      res.json({ message: 'Бронювання успішно видалено' });\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;;AAGA,MAAa,qBAAqB;IAChC,YAAoB,kBAAsC;QAAtC,uBAAkB,GAAlB,kBAAkB,CAAoB;QAE1D,sBAAiB,GAAG,KAAK,EAAE,GAA6B,EAAE,GAAa,EAAE,IAAkB,EAAiB,EAAE;YAC5G,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;gBACd,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,8BAA8B,EAAE,CAAC,CAAC;gBAClE,OAAO;YACT,CAAC;YAED,IAAI,CAAC;gBACH,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,GAAG,CAAC,IAAI,CAAC;gBAC/C,MAAM,cAAc,GAAG,MAAM,IAAI,CAAC,kBAAkB,CAAC,iBAAiB,CACpE,GAAG,CAAC,IAAI,CAAC,EAAE,EACX,QAAQ,EACR,SAAS,EACT,IAAI,IAAI,CAAC,IAAI,CAAC,CACf,CAAC;gBACF,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;YACvC,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,IAAI,CAAC,KAAK,CAAC,CAAC;YACd,CAAC;QACH,CAAC,CAAC;QAEF,sBAAiB,GAAG,KAAK,EACvB,GAAsD,EACtD,GAAa,EACb,IAAkB,EACH,EAAE;YACjB,IAAI,CAAC;gBACH,MAAM,EAAE,GAAG,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;gBACvC,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC,IAAI,CAAC;gBAElC,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,kBAAkB,CAAC,iBAAiB,CAAC,EAAE,EAAE,GAAG,CAAC,IAAK,EAAE;oBAC7E,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,SAAS;oBACvC,MAAM;iBACP,CAAC,CAAC;gBAEH,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,8BAA8B,EAAE,OAAO,EAAE,CAAC,CAAC;YAC7E,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,IAAI,CAAC,KAAK,CAAC,CAAC;YACd,CAAC;QACH,CAAC,CAAC;QAEF,uBAAkB,GAAG,KAAK,EACxB,GAAsD,EACtD,GAAa,EACb,IAAkB,EAClB,EAAE;YACF,IAAI,CAAC;gBACH,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,kBAAkB,CAAC,kBAAkB,CAAC,GAAG,CAAC,IAAK,CAAC,CAAC;gBACjF,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YACrC,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,IAAI,CAAC,KAAK,CAAC,CAAC;YACd,CAAC;QACH,CAAC,CAAC;QAEF,uBAAkB,GAAG,KAAK,EACxB,GAAsD,EACtD,GAAa,EACb,IAAkB,EACH,EAAE;YACjB,IAAI,CAAC;gBACH,MAAM,EAAE,GAAG,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;gBACvC,MAAM,WAAW,GAAG,MAAM,IAAI,CAAC,kBAAkB,CAAC,kBAAkB,CAAC,EAAE,EAAE,GAAG,CAAC,IAAK,CAAC,CAAC;gBACpF,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YACxB,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,IAAI,CAAC,KAAK,CAAC,CAAC;YACd,CAAC;QACH,CAAC,CAAC;QAEF,mBAAc,GAAG,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAiB,EAAE;YACxF,IAAI,CAAC;gBACH,MAAM,QAAQ,GAAG,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,EAAE,EAAE,CAAC,CAAC;gBAC1D,MAAM,OAAO,GAAG,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;gBACvC,MAAM,SAAS,GAAG,GAAG,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,SAAS,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;gBAE9F,IAAI,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;oBAChC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,+CAA+C,EAAE,CAAC,CAAC;oBACnF,OAAO;gBACT,CAAC;gBAED,MAAM,KAAK,GAAG,MAAM,IAAI,CAAC,kBAAkB,CAAC,cAAc,CAAC,QAAQ,EAAE,OAAO,EAAE,SAAS,CAAC,CAAC;gBACzF,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAClB,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,IAAI,CAAC,KAAK,CAAC,CAAC;YACd,CAAC;QACH,CAAC,CAAC;QAEF,sBAAiB,GAAG,KAAK,EACvB,GAAsD,EACtD,GAAa,EACb,IAAkB,EACH,EAAE;YACjB,IAAI,CAAC;gBACH,MAAM,EAAE,GAAG,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;gBACvC,MAAM,IAAI,CAAC,kBAAkB,CAAC,iBAAiB,CAAC,EAAE,EAAE,GAAG,CAAC,IAAK,CAAC,CAAC;gBAC/D,GAAG,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,6BAA6B,EAAE,CAAC,CAAC;YACvD,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,IAAI,CAAC,KAAK,CAAC,CAAC;YACd,CAAC;QACH,CAAC,CAAC;IAnG2D,CAAC;CAoG/D;AArGD,sDAqGC","debug_id":"6cc01035-0cb3-55d0-bd2e-a51f318d6570"}